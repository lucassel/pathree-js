var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var i={id:e,exports:{}};return t[e]=i,n.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},e.parcelRequire5b70=n);var i=n("ilwiq"),o=n("kp7Te"),l=n("891vQ"),r=n("7lx9d"),s=n("jiuw3"),d=function(){var e=0,t=document.createElement("div");function a(e){return t.appendChild(e.dom),e}function n(a){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===a?"block":"none";e=a}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(a){a.preventDefault(),n(++e%t.children.length)}),!1);var i=(performance||Date).now(),o=i,l=0,r=a(new d.Panel("FPS","#0ff","#002")),s=a(new d.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=a(new d.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:a,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(s.update(e-i,200),e>=o+1e3&&(r.update(1e3*l/(e-o),100),o=e,l=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:n}};d.Panel=function(e,t,a){var n=1/0,i=0,o=Math.round,l=o(window.devicePixelRatio||1),r=80*l,s=48*l,d=3*l,c=2*l,p=3*l,m=15*l,u=74*l,g=30*l,h=document.createElement("canvas");h.width=r,h.height=s,h.style.cssText="width:80px;height:48px";var f=h.getContext("2d");return f.font="bold "+9*l+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=a,f.fillRect(0,0,r,s),f.fillStyle=t,f.fillText(e,d,c),f.fillRect(p,m,u,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(p,m,u,g),{dom:h,update:function(s,y){n=Math.min(n,s),i=Math.max(i,s),f.fillStyle=a,f.globalAlpha=1,f.fillRect(0,0,r,m),f.fillStyle=t,f.fillText(o(s)+" "+e+" ("+o(n)+"-"+o(i)+")",d,c),f.drawImage(h,p+l,m,u-l,g,p,m,u-l,g),f.fillRect(p+u-l,m,l,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(p+u-l,m,l,o((1-s/y)*g))}}};var c=d,p=n("cVdfP"),m=n("4CEV9"),u=n("RPVlj"),g=n("5Rd1x");const h="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/",f={multipleImportanceSampling:!0,acesToneMapping:!0,tilesX:2,tilesY:2,samplesPerFrame:1,scale:1/window.devicePixelRatio,model:"",checkerboardTransparency:!0,enable:!0,bounces:5,pause:!1,imageMode:"hidden",imageOpacity:.5,imageType:"dspbr-pt"};let y,b,w,v,x,M,T,S,F,E,R,C,P,k,L,A=!1,I=0;function D(){if(requestAnimationFrame(D),T.update(),x.style.display="hidden"===f.imageMode?"none":"inline-block",x.style.opacity="side-by-side"===f.imageMode?1:f.imageOpacity,x.style.position="side-by-side"===f.imageMode?"initial":"absolute",x.style.width=F.domElement.style.width,x.style.height=F.domElement.style.height,!A){if((R.samples<1||!f.enable)&&F.render(k,E),f.enable&&0===I){const e=Math.floor(R.samples);if(w.innerText=`samples: ${e}`,R.material.materials.updateFrom(S.materials,S.textures),R.material.filterGlossyFactor=.5,R.material.bounces=f.bounces,R.material.physicalCamera.updateFrom(E),E.updateMatrixWorld(),!f.pause||R.samples<1)for(let e=0,t=f.samplesPerFrame;e<t;e++)R.update();F.autoClear=!1,C.render(F),F.autoClear=!0}else I>0&&I--;w.innerText=`Samples: ${Math.floor(R.samples)}`}}function O(){f.tilesX*f.tilesY!=1&&(I=1),R.reset()}async function B(){let e,t;M&&(v.classList.remove("checkerboard"),M.destroy(),M=null);const a=new i.LoadingManager,n=L[f.model];window.location.hash=f.model;let{orbit:d={},target:c={},dimensions:u={}}=n;const{verticalFoV:g=45,renderSkybox:x=!1,lighting:T="../../../shared-assets/environments/lightroom_14b.hdr"}=n;d=Object.assign({},{theta:0,phi:90,radius:1},d),c=Object.assign({},{x:0,y:0,z:0},c),u=Object.assign({},{width:768,height:768},u),A=!0,v.style.display="none",w.innerText="--",y.innerText="--",b.innerText="Loading",b.style.visibility="visible",j(),k.traverse((e=>{if(e.material){const t=e.material;for(const e in t)t[e]&&t[e].isTexture&&t[e].dispose()}})),S&&k.remove(S.scene);let C=new URL(n.model,h).toString();C=C.replace(/.*?glTF-Sample-Models/,"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master"),a.onLoad=async()=>{(new m.MaterialReducer).process(e),e.updateMatrixWorld();const a=new p.PathTracingSceneWorker,o=await a.generate(e,{onProgress:e=>{const t=Math.floor(100*e);b.innerText=`Building BVH : ${t}%`}});S=o,k.add(S.scene);const{bvh:l,textures:r,materials:h}=o,w=l.geometry,T=R.material;T.bvh.updateFrom(l),T.normalAttribute.updateFrom(w.attributes.normal),T.tangentAttribute.updateFrom(w.attributes.tangent),T.uvAttribute.updateFrom(w.attributes.uv),T.materialIndexAttribute.updateFrom(w.attributes.materialIndex),T.textures.setTextures(F,2048,2048,r),T.materials.updateFrom(h,r),T.envMapInfo.updateFrom(t),a.dispose(),t.mapping=i.EquirectangularReflectionMapping,k.environment=t,k.background=t,b.style.visibility="hidden",y.innerHTML=n.credit||"",y.style.visibility=n.credit?"visible":"hidden",function(){M&&M.destroy(),M=new s.GUI,M.add(f,"model",Object.keys(L)).onChange(B);const e=M.addFolder("path tracing");e.add(f,"enable"),e.add(f,"pause"),e.add(f,"scale",0,1).onChange((e=>{const t=window.devicePixelRatio;let{dimensions:a={}}=L[f.model];a=Object.assign({},{width:768,height:768},a);const{width:n,height:i}=a;R.setSize(n*t*e,i*t*e),R.reset()})),e.add(f,"multipleImportanceSampling").onChange((e=>{R.material.setDefine("FEATURE_MIS",Number(e)),R.reset()})),e.add(f,"acesToneMapping").onChange((e=>{F.toneMapping=e?i.ACESFilmicToneMapping:i.NoToneMapping})),e.add(f,"bounces",1,20,1).onChange((()=>{R.reset()}));const t=M.addFolder("comparison");t.add(f,"imageMode",["hidden","overlay","side-by-side"]),t.add(f,"imageType",["dspbr-pt","filament","babylon","gltf-sample-viewer","model-viewer","rhodonite","stellar"]).onChange(j),t.add(f,"imageOpacity",0,1);const a=M.addFolder("resolution");a.add(f,"samplesPerFrame",1,10,1),a.add(f,"tilesX",1,10,1).onChange((e=>{R.tiles.x=e})),a.add(f,"tilesY",1,10,1).onChange((e=>{R.tiles.y=e})),a.open(),M.addFolder("background").add(f,"checkerboardTransparency").onChange((e=>{e?v.classList.add("checkerboard"):v.classList.remove("checkerboard")}))}(),E.position.setFromSphericalCoords(d.radius,i.MathUtils.DEG2RAD*d.phi,i.MathUtils.DEG2RAD*d.theta),E.position.x+=c.x,E.position.y+=c.y,E.position.z+=c.z;const C=window.devicePixelRatio,{width:I,height:D}=u;F.setSize(I,D),F.setPixelRatio(C),R.setSize(I*C*f.scale,D*C*f.scale),E.aspect=I/D,E.fov=g,E.updateProjectionMatrix(),P.target.set(c.x,c.y,c.z),P.update(),E.updateMatrixWorld(),R.material.backgroundAlpha=x?1:0,R.reset(),v.style.display="flex",A=!1,f.checkerboardTransparency&&v.classList.add("checkerboard")};const I=new URL(T,h).toString();new l.RGBELoader(a).load(I,(e=>{t=e})),new r.GLTFLoader(a).setMeshoptDecoder(o.MeshoptDecoder).load(C,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);b.innerText=`Loading : ${t}%`}}))}function j(){x.src=`https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${f.model}/${f.imageType}-golden.png`}!async function(){y=document.getElementById("credits"),b=document.getElementById("loading"),w=document.getElementById("samples"),v=document.getElementById("container"),x=document.querySelector("img"),F=new i.WebGLRenderer({antialias:!0}),F.outputEncoding=i.sRGBEncoding,F.toneMapping=i.ACESFilmicToneMapping,F.physicallyCorrectLights=!0,v.appendChild(F.domElement),k=new i.Scene;const e=window.innerWidth/window.innerHeight;E=new i.PerspectiveCamera(60,e,.01,500),E.position.set(-1,.25,1),R=new m.PathTracingRenderer(F),R.camera=E,R.alpha=!0,R.material=new m.PhysicalPathTracingMaterial,R.tiles.set(f.tiles,f.tiles),R.material.setDefine("FEATURE_MIS",Number(f.multipleImportanceSampling)),R.tiles.set(f.tilesX,f.tilesY),C=new u.FullScreenQuad(new i.MeshBasicMaterial({map:R.target.texture,blending:i.CustomBlending})),P=new g.OrbitControls(E,v),P.addEventListener("change",O),T=new c,v.appendChild(T.dom);const{scenarios:t}=await(await fetch("https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json")).json();L={},t.forEach((e=>{L[e.name]=e}));let a=t[0].name;if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in L&&(a=e)}f.model=a,B(),D()}();
//# sourceMappingURL=viewerTest.daf0f9c0.js.map
