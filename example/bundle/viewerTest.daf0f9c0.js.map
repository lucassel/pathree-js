{"mappings":"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","sources":["example/viewerTest.js","node_modules/three/examples/jsm/libs/stats.module.js"],"sourcesContent":["import {\n\tACESFilmicToneMapping,\n\tNoToneMapping,\n\tLoadingManager,\n\tWebGLRenderer,\n\tScene,\n\tPerspectiveCamera,\n\tMeshBasicMaterial,\n\tsRGBEncoding,\n\tCustomBlending,\n\tEquirectangularReflectionMapping,\n\tMathUtils,\n} from 'three';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport Stats from 'three/examples/jsm/libs/stats.module.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { PhysicalPathTracingMaterial, PathTracingRenderer, MaterialReducer } from '../src/index.js';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\n\nconst CONFIG_URL = 'https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json';\nconst BASE_URL = 'https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/';\n\nconst params = {\n\n\tmultipleImportanceSampling: true,\n\tacesToneMapping: true,\n\ttilesX: 2,\n\ttilesY: 2,\n\tsamplesPerFrame: 1,\n\tscale: 1 / window.devicePixelRatio,\n\n\tmodel: '',\n\tcheckerboardTransparency: true,\n\n\tenable: true,\n\tbounces: 5,\n\tpause: false,\n\n\timageMode: 'hidden',\n\timageOpacity: 0.5,\n\timageType: 'dspbr-pt',\n\n};\n\nlet creditEl, loadingEl, samplesEl, containerEl, imgEl;\nlet gui, stats, sceneInfo;\nlet renderer, camera;\nlet ptRenderer, fsQuad, controls, scene;\nlet loadingModel = false;\nlet delaySamples = 0;\nlet models;\n\ninit();\n\nasync function init() {\n\n\t// get elements\n\tcreditEl = document.getElementById( 'credits' );\n\tloadingEl = document.getElementById( 'loading' );\n\tsamplesEl = document.getElementById( 'samples' );\n\tcontainerEl = document.getElementById( 'container' );\n\timgEl = document.querySelector( 'img' );\n\n\t// init renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.outputEncoding = sRGBEncoding;\n\trenderer.toneMapping = ACESFilmicToneMapping;\n\trenderer.physicallyCorrectLights = true;\n\tcontainerEl.appendChild( renderer.domElement );\n\n\t// init scene\n\tscene = new Scene();\n\n\t// init camera\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tcamera = new PerspectiveCamera( 60, aspect, 0.01, 500 );\n\tcamera.position.set( - 1, 0.25, 1 );\n\n\t// init path tracer\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.camera = camera;\n\tptRenderer.alpha = true;\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\tptRenderer.material.setDefine( 'FEATURE_MIS', Number( params.multipleImportanceSampling ) );\n\tptRenderer.tiles.set( params.tilesX, params.tilesY );\n\n\n\t// init fsquad\n\tfsQuad = new FullScreenQuad( new MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t\tblending: CustomBlending\n\t} ) );\n\n\t// init controls\n\tcontrols = new OrbitControls( camera, containerEl );\n\tcontrols.addEventListener( 'change', resetRenderer );\n\n\t// init stats\n\tstats = new Stats();\n\tcontainerEl.appendChild( stats.dom );\n\n\t// init models\n\tconst { scenarios } = await ( await fetch( CONFIG_URL ) ).json();\n\tmodels = {};\n\tscenarios.forEach( s => {\n\n\t\tmodels[ s.name ] = s;\n\n\t} );\n\n\tlet initialModel = scenarios[ 0 ].name;\n\tif ( window.location.hash ) {\n\n\t\tconst modelName = window.location.hash.substring( 1 ).replaceAll( '%20', ' ' );\n\t\tif ( modelName in models ) {\n\n\t\t\tinitialModel = modelName;\n\n\t\t}\n\n\t}\n\n\tparams.model = initialModel;\n\n\tupdateModel();\n\n\tanimate();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tstats.update();\n\n\timgEl.style.display = params.imageMode === 'hidden' ? 'none' : 'inline-block';\n\timgEl.style.opacity = params.imageMode === 'side-by-side' ? 1.0 : params.imageOpacity;\n\timgEl.style.position = params.imageMode === 'side-by-side' ? 'initial' : 'absolute';\n\timgEl.style.width = renderer.domElement.style.width;\n\timgEl.style.height = renderer.domElement.style.height;\n\n\tif ( loadingModel ) {\n\n\t\treturn;\n\n\t}\n\n\tif ( ptRenderer.samples < 1.0 || ! params.enable ) {\n\n\t\trenderer.render( scene, camera );\n\n\t}\n\n\tif ( params.enable && delaySamples === 0 ) {\n\n\t\tconst samples = Math.floor( ptRenderer.samples );\n\t\tsamplesEl.innerText = `samples: ${ samples }`;\n\n\t\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\t\tptRenderer.material.filterGlossyFactor = 0.5;\n\t\tptRenderer.material.bounces = params.bounces;\n\t\tptRenderer.material.physicalCamera.updateFrom( camera );\n\n\t\tcamera.updateMatrixWorld();\n\n\n\n\t\tif ( ! params.pause || ptRenderer.samples < 1 ) {\n\n\t\t\tfor ( let i = 0, l = params.samplesPerFrame; i < l; i ++ ) {\n\n\t\t\t\tptRenderer.update();\n\n\t\t\t}\n\n\t\t}\n\n\t\trenderer.autoClear = false;\n\t\tfsQuad.render( renderer );\n\t\trenderer.autoClear = true;\n\n\t} else if ( delaySamples > 0 ) {\n\n\t\tdelaySamples --;\n\n\t}\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n}\n\nfunction resetRenderer() {\n\n\tif ( params.tilesX * params.tilesY !== 1.0 ) {\n\n\t\tdelaySamples = 1;\n\n\t}\n\n\tptRenderer.reset();\n\n}\n\nfunction buildGui() {\n\n\tif ( gui ) {\n\n\t\tgui.destroy();\n\n\t}\n\n\tgui = new GUI();\n\n\tgui.add( params, 'model', Object.keys( models ) ).onChange( updateModel );\n\n\tconst pathTracingFolder = gui.addFolder( 'path tracing' );\n\tpathTracingFolder.add( params, 'enable' );\n\tpathTracingFolder.add( params, 'pause' );\n\tpathTracingFolder.add( params, 'scale', 0, 1 ).onChange( v => {\n\n\t\tconst dpr = window.devicePixelRatio;\n\t\tlet { dimensions = {} } = models[ params.model ];\n\t\tdimensions = Object.assign( {}, { width: 768, height: 768 }, dimensions );\n\n\t\tconst { width, height } = dimensions;\n\t\tptRenderer.setSize( width * dpr * v, height * dpr * v );\n\t\tptRenderer.reset();\n\n\t} );\n\tpathTracingFolder.add( params, 'multipleImportanceSampling' ).onChange( v => {\n\n\t\tptRenderer.material.setDefine( 'FEATURE_MIS', Number( v ) );\n\t\tptRenderer.reset();\n\n\t} );\n\tpathTracingFolder.add( params, 'acesToneMapping' ).onChange( v => {\n\n\t\trenderer.toneMapping = v ? ACESFilmicToneMapping : NoToneMapping;\n\n\t} );\n\tpathTracingFolder.add( params, 'bounces', 1, 20, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\n\tconst comparisonFolder = gui.addFolder( 'comparison' );\n\tcomparisonFolder.add( params, 'imageMode', [ 'hidden', 'overlay', 'side-by-side' ] );\n\tcomparisonFolder.add( params, 'imageType', [\n\t\t'dspbr-pt',\n\t\t'filament',\n\t\t'babylon',\n\t\t'gltf-sample-viewer',\n\t\t'model-viewer',\n\t\t'rhodonite',\n\t\t'stellar'\n\t] ).onChange( updateImage );\n\tcomparisonFolder.add( params, 'imageOpacity', 0, 1.0 );\n\n\tconst resolutionFolder = gui.addFolder( 'resolution' );\n\tresolutionFolder.add( params, 'samplesPerFrame', 1, 10, 1 );\n\tresolutionFolder.add( params, 'tilesX', 1, 10, 1 ).onChange( v => {\n\n\t\tptRenderer.tiles.x = v;\n\n\t} );\n\tresolutionFolder.add( params, 'tilesY', 1, 10, 1 ).onChange( v => {\n\n\t\tptRenderer.tiles.y = v;\n\n\t} );\n\tresolutionFolder.open();\n\n\tconst backgroundFolder = gui.addFolder( 'background' );\n\tbackgroundFolder.add( params, 'checkerboardTransparency' ).onChange( v => {\n\n\t\tif ( v ) containerEl.classList.add( 'checkerboard' );\n\t\telse containerEl.classList.remove( 'checkerboard' );\n\n\t} );\n\n}\n\nasync function updateModel() {\n\n\tif ( gui ) {\n\n\t\tcontainerEl.classList.remove( 'checkerboard' );\n\t\tgui.destroy();\n\t\tgui = null;\n\n\t}\n\n\tlet model, envMap;\n\tconst manager = new LoadingManager();\n\tconst modelInfo = models[ params.model ];\n\n\twindow.location.hash = params.model;\n\n\tlet {\n\t\torbit = {},\n\t\ttarget = {},\n\t\tdimensions = {},\n\t} = modelInfo;\n\n\tconst {\n\t\tverticalFoV = 45,\n\t\trenderSkybox = false,\n\t\tlighting = '../../../shared-assets/environments/lightroom_14b.hdr',\n\t} = modelInfo;\n\n\torbit = Object.assign( {}, { theta: 0, phi: 90, radius: 1 }, orbit );\n\ttarget = Object.assign( {}, { x: 0, y: 0, z: 0 }, target );\n\tdimensions = Object.assign( {}, { width: 768, height: 768 }, dimensions );\n\n\tloadingModel = true;\n\tcontainerEl.style.display = 'none';\n\tsamplesEl.innerText = '--';\n\tcreditEl.innerText = '--';\n\tloadingEl.innerText = 'Loading';\n\tloadingEl.style.visibility = 'visible';\n\n\tupdateImage();\n\n\tscene.traverse( c => {\n\n\t\tif ( c.material ) {\n\n\t\t\tconst material = c.material;\n\t\t\tfor ( const key in material ) {\n\n\t\t\t\tif ( material[ key ] && material[ key ].isTexture ) {\n\n\t\t\t\t\tmaterial[ key ].dispose();\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\tif ( sceneInfo ) {\n\n\t\tscene.remove( sceneInfo.scene );\n\n\t}\n\n\tconst onFinish = async () => {\n\n\t\tconst reducer = new MaterialReducer();\n\t\treducer.process( model );\n\t\tmodel.updateMatrixWorld();\n\n\t\tconst generator = new PathTracingSceneWorker();\n\t\tconst result = await generator.generate( model, { onProgress: v => {\n\n\t\t\tconst percent = Math.floor( 100 * v );\n\t\t\tloadingEl.innerText = `Building BVH : ${ percent }%`;\n\n\t\t} } );\n\n\t\tsceneInfo = result;\n\t\tscene.add( sceneInfo.scene );\n\n\t\tconst { bvh, textures, materials } = result;\n\t\tconst geometry = bvh.geometry;\n\t\tconst material = ptRenderer.material;\n\n\t\tmaterial.bvh.updateFrom( bvh );\n\t\tmaterial.normalAttribute.updateFrom( geometry.attributes.normal );\n\t\tmaterial.tangentAttribute.updateFrom( geometry.attributes.tangent );\n\t\tmaterial.uvAttribute.updateFrom( geometry.attributes.uv );\n\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\tmaterial.materials.updateFrom( materials, textures );\n\t\tmaterial.envMapInfo.updateFrom( envMap );\n\n\t\tgenerator.dispose();\n\n\t\tenvMap.mapping = EquirectangularReflectionMapping;\n\t\tscene.environment = envMap;\n\t\tscene.background = envMap;\n\n\t\tloadingEl.style.visibility = 'hidden';\n\n\t\tcreditEl.innerHTML = modelInfo.credit || '';\n\t\tcreditEl.style.visibility = modelInfo.credit ? 'visible' : 'hidden';\n\t\tbuildGui();\n\n\t\tcamera.position.setFromSphericalCoords( orbit.radius, MathUtils.DEG2RAD * orbit.phi, MathUtils.DEG2RAD * orbit.theta );\n\t\tcamera.position.x += target.x;\n\t\tcamera.position.y += target.y;\n\t\tcamera.position.z += target.z;\n\n\t\tconst dpr = window.devicePixelRatio;\n\t\tconst { width, height } = dimensions;\n\t\trenderer.setSize( width, height );\n\t\trenderer.setPixelRatio( dpr );\n\t\tptRenderer.setSize( width * dpr * params.scale, height * dpr * params.scale );\n\t\tcamera.aspect = width / height;\n\t\tcamera.fov = verticalFoV;\n\t\tcamera.updateProjectionMatrix();\n\n\t\tcontrols.target.set( target.x, target.y, target.z );\n\t\tcontrols.update();\n\t\tcamera.updateMatrixWorld();\n\n\t\tptRenderer.material.backgroundAlpha = renderSkybox ? 1 : 0;\n\n\t\tptRenderer.reset();\n\n\t\tcontainerEl.style.display = 'flex';\n\t\tloadingModel = false;\n\t\tif ( params.checkerboardTransparency ) {\n\n\t\t\tcontainerEl.classList.add( 'checkerboard' );\n\n\t\t}\n\n\t};\n\n\tlet modelUrl = new URL( modelInfo.model, BASE_URL ).toString();\n\tmodelUrl = modelUrl.replace( /.*?glTF-Sample-Models/, 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master' );\n\n\tmanager.onLoad = onFinish;\n\n\tconst envUrl = new URL( lighting, BASE_URL ).toString();\n\tnew RGBELoader( manager )\n\t\t.load( envUrl, res => {\n\n\t\t\tenvMap = res;\n\n\t\t} );\n\n\tnew GLTFLoader( manager )\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.load(\n\t\t\tmodelUrl,\n\t\t\tgltf => {\n\n\t\t\t\tmodel = gltf.scene;\n\n\t\t\t},\n\t\t\tprogress => {\n\n\t\t\t\tif ( progress.total !== 0 && progress.total >= progress.loaded ) {\n\n\t\t\t\t\tconst percent = Math.floor( 100 * progress.loaded / progress.total );\n\t\t\t\t\tloadingEl.innerText = `Loading : ${ percent }%`;\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t);\n\n}\n\nfunction updateImage() {\n\n\timgEl.src = `https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${ params.model }/${ params.imageType }-golden.png`;\n\n}\n","var Stats = function () {\n\n\tvar mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.style.cssText = 'position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000';\n\tcontainer.addEventListener( 'click', function ( event ) {\n\n\t\tevent.preventDefault();\n\t\tshowPanel( ++ mode % container.children.length );\n\n\t}, false );\n\n\t//\n\n\tfunction addPanel( panel ) {\n\n\t\tcontainer.appendChild( panel.dom );\n\t\treturn panel;\n\n\t}\n\n\tfunction showPanel( id ) {\n\n\t\tfor ( var i = 0; i < container.children.length; i ++ ) {\n\n\t\t\tcontainer.children[ i ].style.display = i === id ? 'block' : 'none';\n\n\t\t}\n\n\t\tmode = id;\n\n\t}\n\n\t//\n\n\tvar beginTime = ( performance || Date ).now(), prevTime = beginTime, frames = 0;\n\n\tvar fpsPanel = addPanel( new Stats.Panel( 'FPS', '#0ff', '#002' ) );\n\tvar msPanel = addPanel( new Stats.Panel( 'MS', '#0f0', '#020' ) );\n\n\tif ( self.performance && self.performance.memory ) {\n\n\t\tvar memPanel = addPanel( new Stats.Panel( 'MB', '#f08', '#201' ) );\n\n\t}\n\n\tshowPanel( 0 );\n\n\treturn {\n\n\t\tREVISION: 16,\n\n\t\tdom: container,\n\n\t\taddPanel: addPanel,\n\t\tshowPanel: showPanel,\n\n\t\tbegin: function () {\n\n\t\t\tbeginTime = ( performance || Date ).now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tframes ++;\n\n\t\t\tvar time = ( performance || Date ).now();\n\n\t\t\tmsPanel.update( time - beginTime, 200 );\n\n\t\t\tif ( time >= prevTime + 1000 ) {\n\n\t\t\t\tfpsPanel.update( ( frames * 1000 ) / ( time - prevTime ), 100 );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t\tif ( memPanel ) {\n\n\t\t\t\t\tvar memory = performance.memory;\n\t\t\t\t\tmemPanel.update( memory.usedJSHeapSize / 1048576, memory.jsHeapSizeLimit / 1048576 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tbeginTime = this.end();\n\n\t\t},\n\n\t\t// Backwards Compatibility\n\n\t\tdomElement: container,\n\t\tsetMode: showPanel\n\n\t};\n\n};\n\nStats.Panel = function ( name, fg, bg ) {\n\n\tvar min = Infinity, max = 0, round = Math.round;\n\tvar PR = round( window.devicePixelRatio || 1 );\n\n\tvar WIDTH = 80 * PR, HEIGHT = 48 * PR,\n\t\tTEXT_X = 3 * PR, TEXT_Y = 2 * PR,\n\t\tGRAPH_X = 3 * PR, GRAPH_Y = 15 * PR,\n\t\tGRAPH_WIDTH = 74 * PR, GRAPH_HEIGHT = 30 * PR;\n\n\tvar canvas = document.createElement( 'canvas' );\n\tcanvas.width = WIDTH;\n\tcanvas.height = HEIGHT;\n\tcanvas.style.cssText = 'width:80px;height:48px';\n\n\tvar context = canvas.getContext( '2d' );\n\tcontext.font = 'bold ' + ( 9 * PR ) + 'px Helvetica,Arial,sans-serif';\n\tcontext.textBaseline = 'top';\n\n\tcontext.fillStyle = bg;\n\tcontext.fillRect( 0, 0, WIDTH, HEIGHT );\n\n\tcontext.fillStyle = fg;\n\tcontext.fillText( name, TEXT_X, TEXT_Y );\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\tcontext.fillStyle = bg;\n\tcontext.globalAlpha = 0.9;\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\n\n\treturn {\n\n\t\tdom: canvas,\n\n\t\tupdate: function ( value, maxValue ) {\n\n\t\t\tmin = Math.min( min, value );\n\t\t\tmax = Math.max( max, value );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 1;\n\t\t\tcontext.fillRect( 0, 0, WIDTH, GRAPH_Y );\n\t\t\tcontext.fillStyle = fg;\n\t\t\tcontext.fillText( round( value ) + ' ' + name + ' (' + round( min ) + '-' + round( max ) + ')', TEXT_X, TEXT_Y );\n\n\t\t\tcontext.drawImage( canvas, GRAPH_X + PR, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT, GRAPH_X, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT );\n\n\t\t\tcontext.fillStyle = bg;\n\t\t\tcontext.globalAlpha = 0.9;\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, round( ( 1 - ( value / maxValue ) ) * GRAPH_HEIGHT ) );\n\n\t\t}\n\n\t};\n\n};\n\nexport default Stats;\n"],"names":["$ilwiq","parcelRequire","$5aae44c9b1864d53$var$Stats","mode","container","document","createElement","addPanel","panel","appendChild","dom","showPanel","id","i","children","length","style","display","cssText","addEventListener","event","preventDefault","beginTime","performance","Date","now","prevTime","frames","fpsPanel","Panel","msPanel","self","memory","memPanel","REVISION","begin","end","time","update","usedJSHeapSize","jsHeapSizeLimit","this","domElement","setMode","name","fg","bg","min","Infinity","max","round","Math","PR","window","devicePixelRatio","WIDTH","HEIGHT","TEXT_X","TEXT_Y","GRAPH_X","GRAPH_Y","GRAPH_WIDTH","GRAPH_HEIGHT","canvas","width","height","context","getContext","font","textBaseline","fillStyle","fillRect","fillText","globalAlpha","value","maxValue","drawImage","$5aae44c9b1864d53$export$2e2bcd8739ae039","$f6c83a1fcfd19596$var$BASE_URL","$f6c83a1fcfd19596$var$params","multipleImportanceSampling","acesToneMapping","tilesX","tilesY","samplesPerFrame","scale","model","checkerboardTransparency","enable","bounces","pause","imageMode","imageOpacity","imageType","$f6c83a1fcfd19596$var$creditEl","$f6c83a1fcfd19596$var$loadingEl","$f6c83a1fcfd19596$var$samplesEl","$f6c83a1fcfd19596$var$containerEl","$f6c83a1fcfd19596$var$imgEl","$f6c83a1fcfd19596$var$gui","$f6c83a1fcfd19596$var$stats","$f6c83a1fcfd19596$var$sceneInfo","$f6c83a1fcfd19596$var$renderer","$f6c83a1fcfd19596$var$camera","$f6c83a1fcfd19596$var$ptRenderer","$f6c83a1fcfd19596$var$fsQuad","$f6c83a1fcfd19596$var$controls","$f6c83a1fcfd19596$var$scene","$f6c83a1fcfd19596$var$models","$f6c83a1fcfd19596$var$loadingModel","$f6c83a1fcfd19596$var$delaySamples","$f6c83a1fcfd19596$var$animate","requestAnimationFrame","opacity","position","samples","render","floor","innerText","material","materials","updateFrom","textures","filterGlossyFactor","physicalCamera","updateMatrixWorld","l","autoClear","$f6c83a1fcfd19596$var$resetRenderer","reset","async","$f6c83a1fcfd19596$var$updateModel","envMap","classList","remove","destroy","manager","LoadingManager","modelInfo","location","hash","orbit","target","dimensions","verticalFoV","renderSkybox","lighting","Object","assign","theta","phi","radius","x","y","z","visibility","$f6c83a1fcfd19596$var$updateImage","traverse","c","key","isTexture","dispose","scene","modelUrl","URL","toString","replace","onLoad","$4CEV9","MaterialReducer","process","generator","$cVdfP","PathTracingSceneWorker","result","generate","onProgress","v","percent","add","bvh","geometry","normalAttribute","attributes","normal","tangentAttribute","tangent","uvAttribute","uv","materialIndexAttribute","materialIndex","setTextures","envMapInfo","mapping","EquirectangularReflectionMapping","environment","background","innerHTML","credit","$jiuw3","GUI","keys","onChange","pathTracingFolder","addFolder","dpr","setSize","setDefine","Number","toneMapping","ACESFilmicToneMapping","NoToneMapping","comparisonFolder","resolutionFolder","tiles","open","$f6c83a1fcfd19596$var$buildGui","setFromSphericalCoords","MathUtils","DEG2RAD","setPixelRatio","aspect","fov","updateProjectionMatrix","set","backgroundAlpha","envUrl","$891vQ","RGBELoader","load","res","$7lx9d","GLTFLoader","setMeshoptDecoder","$kp7Te","MeshoptDecoder","gltf","progress","total","loaded","src","getElementById","querySelector","WebGLRenderer","antialias","outputEncoding","sRGBEncoding","physicallyCorrectLights","Scene","innerWidth","innerHeight","PerspectiveCamera","PathTracingRenderer","camera","alpha","PhysicalPathTracingMaterial","$RPVlj","FullScreenQuad","MeshBasicMaterial","map","texture","blending","CustomBlending","$5Rd1x","OrbitControls","scenarios","fetch","json","forEach","s","initialModel","modelName","substring","replaceAll","$f6c83a1fcfd19596$var$init"],"version":3,"file":"viewerTest.daf0f9c0.js.map"}